<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="797px" preserveAspectRatio="none" style="width:2080px;height:797px;" version="1.1" viewBox="0 0 2080 797" width="2080px" zoomAndPan="magnify"><defs><filter height="300%" id="fr57tnwcoocqy" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><!--class EmailSender--><rect fill="#FEFECE" filter="url(#fr57tnwcoocqy)" height="57.5781" id="EmailSender" style="stroke: #A80036; stroke-width: 1.5;" width="384" x="1447.5" y="332.5"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="78" x="1600.5" y="348.6387">EmailSender</text><line style="stroke: #A80036; stroke-width: 1.5;" x1="1448.5" x2="1830.5" y1="356.4688" y2="356.4688"/><ellipse cx="1458.5" cy="368.3711" fill="#84BE84" rx="3" ry="3" style="stroke: #038048; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" font-style="italic" lengthAdjust="spacingAndGlyphs" textLength="291" x="1467.5" y="370.6792">send(EmailContent, optional&lt;EmailHeaders&gt;): bool</text><ellipse cx="1458.5" cy="381.1758" fill="#84BE84" rx="3" ry="3" style="stroke: #038048; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" font-style="italic" lengthAdjust="spacingAndGlyphs" textLength="358" x="1467.5" y="383.4839">reply(EmailContent, EmailData, optional&lt;EmailHeaders&gt;): bool</text><!--class EmailReceiver--><rect fill="#FEFECE" filter="url(#fr57tnwcoocqy)" height="57.5781" id="EmailReceiver" style="stroke: #A80036; stroke-width: 1.5;" width="374" x="651.5" y="8"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="86" x="795.5" y="24.1387">EmailReceiver</text><line style="stroke: #A80036; stroke-width: 1.5;" x1="652.5" x2="1024.5" y1="31.9688" y2="31.9688"/><ellipse cx="662.5" cy="43.8711" fill="#84BE84" rx="3" ry="3" style="stroke: #038048; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" font-style="italic" lengthAdjust="spacingAndGlyphs" textLength="348" x="671.5" y="46.1792">get_email(nanoseconds polling_period): optional&lt;EmailData&gt;</text><ellipse cx="662.5" cy="56.6758" fill="#84BE84" rx="3" ry="3" style="stroke: #038048; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="63" x="671.5" y="58.9839">shutdown()</text><!--class PollingManager--><rect fill="#FEFECE" filter="url(#fr57tnwcoocqy)" height="116.7969" id="PollingManager" style="stroke: #A80036; stroke-width: 1.5;" width="292" x="692.5" y="126"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="96" x="790.5" y="142.1387">PollingManager</text><line style="stroke: #A80036; stroke-width: 1.5;" x1="693.5" x2="983.5" y1="149.9688" y2="149.9688"/><rect fill="none" height="6" style="stroke: #C82930; stroke-width: 1.0;" width="6" x="700.5" y="158.8711"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="37" x="712.5" y="164.1792">thread</text><line style="stroke: #A80036; stroke-width: 1.5;" x1="693.5" x2="983.5" y1="170.7734" y2="170.7734"/><rect fill="#F24D5C" height="6" style="stroke: #C82930; stroke-width: 1.0;" width="6" x="700.5" y="179.6758"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="266" x="712.5" y="184.9839">handlers: vector&lt;function&lt;void (EmailData)&gt;&gt;</text><rect fill="#F24D5C" height="6" style="stroke: #C82930; stroke-width: 1.0;" width="6" x="700.5" y="192.4805"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="71" x="712.5" y="197.7886">poll_thread()</text><ellipse cx="703.5" cy="208.2852" fill="#84BE84" rx="3" ry="3" style="stroke: #038048; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="35" x="712.5" y="210.5933">start()</text><ellipse cx="703.5" cy="221.0898" fill="#84BE84" rx="3" ry="3" style="stroke: #038048; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="63" x="712.5" y="223.3979">shutdown()</text><ellipse cx="703.5" cy="233.8945" fill="#84BE84" rx="3" ry="3" style="stroke: #038048; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="257" x="712.5" y="236.2026">register_handler(function&lt;void (EmailData)&gt;)</text><!--class EmailHandler--><rect fill="#FEFECE" filter="url(#fr57tnwcoocqy)" height="57.5781" id="EmailHandler" style="stroke: #A80036; stroke-width: 1.5;" width="292" x="218.5" y="155.5"/><text fill="#000000" font-family="sans-serif" font-size="12" font-style="italic" lengthAdjust="spacingAndGlyphs" textLength="82" x="323.5" y="171.6387">EmailHandler</text><line style="stroke: #A80036; stroke-width: 1.5;" x1="219.5" x2="509.5" y1="179.4688" y2="179.4688"/><ellipse cx="229.5" cy="191.3711" fill="#84BE84" rx="3" ry="3" style="stroke: #038048; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" font-style="italic" lengthAdjust="spacingAndGlyphs" textLength="266" x="238.5" y="193.6792">register_handler(shared_ptr&lt;PollingManager&gt;)</text><ellipse cx="229.5" cy="204.1758" fill="#84BE84" rx="3" ry="3" style="stroke: #038048; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" font-style="italic" lengthAdjust="spacingAndGlyphs" textLength="103" x="238.5" y="206.4839">handle(EmailData)</text><!--class SubscriptionHandler--><rect fill="#FEFECE" filter="url(#fr57tnwcoocqy)" height="91.1875" id="SubscriptionHandler" style="stroke: #A80036; stroke-width: 1.5;" width="569" x="6" y="316"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="127" x="227" y="332.1387">SubscriptionHandler</text><line style="stroke: #A80036; stroke-width: 1.5;" x1="7" x2="574" y1="339.9688" y2="339.9688"/><rect fill="none" height="6" style="stroke: #C82930; stroke-width: 1.0;" width="6" x="14" y="348.8711"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="375" x="26" y="354.1792">subscriptions: map&lt;string, queue&lt;pair&lt;string, MessageInfo&gt;&gt;&gt;</text><line style="stroke: #A80036; stroke-width: 1.5;" x1="7" x2="574" y1="360.7734" y2="360.7734"/><ellipse cx="17" cy="372.6758" fill="#84BE84" rx="3" ry="3" style="stroke: #038048; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="543" x="26" y="374.9839">register_subscription(string topic_name, queue&lt;pair&lt;string, MessageInfo&gt;&gt; message_queue)</text><ellipse cx="17" cy="385.4805" fill="#84BE84" rx="3" ry="3" style="stroke: #038048; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" font-style="italic" lengthAdjust="spacingAndGlyphs" textLength="266" x="26" y="387.7886">register_handler(shared_ptr&lt;PollingManager&gt;)</text><ellipse cx="17" cy="398.2852" fill="#84BE84" rx="3" ry="3" style="stroke: #038048; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" font-style="italic" lengthAdjust="spacingAndGlyphs" textLength="103" x="26" y="400.5933">handle(EmailData)</text><!--class ServiceHandler--><rect fill="#FEFECE" filter="url(#fr57tnwcoocqy)" height="116.7969" id="ServiceHandler" style="stroke: #A80036; stroke-width: 1.5;" width="603" x="610" y="303"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="94" x="864.5" y="319.1387">ServiceHandler</text><line style="stroke: #A80036; stroke-width: 1.5;" x1="611" x2="1212" y1="326.9688" y2="326.9688"/><rect fill="none" height="6" style="stroke: #C82930; stroke-width: 1.0;" width="6" x="618" y="335.8711"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="546" x="630" y="341.1792">clients: map&lt;GidValue, shared_ptr&lt;map&lt;SequenceNumber, pair&lt;EmailData, ServiceInfo&gt;&gt;&gt;&gt;</text><rect fill="none" height="6" style="stroke: #C82930; stroke-width: 1.0;" width="6" x="618" y="348.6758"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="437" x="630" y="353.9839">servers: map&lt;string, shared_ptr&lt;queue&lt;pair&lt;EmailData, ServiceInfo&gt;&gt;&gt;&gt;</text><line style="stroke: #A80036; stroke-width: 1.5;" x1="611" x2="1212" y1="360.5781" y2="360.5781"/><ellipse cx="621" cy="372.4805" fill="#84BE84" rx="3" ry="3" style="stroke: #038048; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="572" x="630" y="374.7886">register_service_client(Gid, map&lt;SequenceNumber, pair&lt;EmailData, ServiceInfo&gt;&gt; response_map)</text><ellipse cx="621" cy="385.2852" fill="#84BE84" rx="3" ry="3" style="stroke: #038048; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="577" x="630" y="387.5933">register_service_server(string service_name, queue&lt;pair&lt;EmailData, ServiceInfo&gt;&gt; request_queue)</text><ellipse cx="621" cy="398.0898" fill="#84BE84" rx="3" ry="3" style="stroke: #038048; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" font-style="italic" lengthAdjust="spacingAndGlyphs" textLength="266" x="630" y="400.3979">register_handler(shared_ptr&lt;PollingManager&gt;)</text><ellipse cx="621" cy="410.8945" fill="#84BE84" rx="3" ry="3" style="stroke: #038048; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" font-style="italic" lengthAdjust="spacingAndGlyphs" textLength="103" x="630" y="413.2026">handle(EmailData)</text><!--class GidObject--><rect fill="#FEFECE" filter="url(#fr57tnwcoocqy)" height="65.5781" id="GidObject" style="stroke: #A80036; stroke-width: 1.5;" width="102" x="1790.5" y="151.5"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="60" x="1811.5" y="167.6387">GidObject</text><line style="stroke: #A80036; stroke-width: 1.5;" x1="1791.5" x2="1891.5" y1="175.4688" y2="175.4688"/><rect fill="none" height="6" style="stroke: #C82930; stroke-width: 1.0;" width="6" x="1798.5" y="184.3711"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="44" x="1810.5" y="189.6792">gid: Gid</text><line style="stroke: #A80036; stroke-width: 1.5;" x1="1791.5" x2="1891.5" y1="196.2734" y2="196.2734"/><ellipse cx="1801.5" cy="208.1758" fill="#84BE84" rx="3" ry="3" style="stroke: #038048; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="76" x="1810.5" y="210.4839">get_gid(): Gid</text><!--class NamedObject--><rect fill="#FEFECE" filter="url(#fr57tnwcoocqy)" height="78.3828" id="NamedObject" style="stroke: #A80036; stroke-width: 1.5;" width="171" x="1358" y="145.5"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="84" x="1401.5" y="161.6387">NamedObject</text><line style="stroke: #A80036; stroke-width: 1.5;" x1="1359" x2="1528" y1="169.4688" y2="169.4688"/><rect fill="none" height="6" style="stroke: #C82930; stroke-width: 1.0;" width="6" x="1366" y="178.3711"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="113" x="1378" y="183.6792">object_name: string</text><line style="stroke: #A80036; stroke-width: 1.5;" x1="1359" x2="1528" y1="190.2734" y2="190.2734"/><polygon fill="#FFFF44" points="1369,197.1758,1373,201.1758,1369,205.1758,1365,201.1758" style="stroke: #B38D22; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="145" x="1378" y="204.4839">get_object_name(): string</text><polygon fill="#FFFF44" points="1369,209.9805,1373,213.9805,1369,217.9805,1365,213.9805" style="stroke: #B38D22; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" font-style="italic" lengthAdjust="spacingAndGlyphs" textLength="91" x="1378" y="217.2886">validate_name()</text><!--class PubSubObject--><rect fill="#FEFECE" filter="url(#fr57tnwcoocqy)" height="57.5781" id="PubSubObject" style="stroke: #A80036; stroke-width: 1.5;" width="164" x="1248.5" y="332.5"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="88" x="1286.5" y="348.6387">PubSubObject</text><line style="stroke: #A80036; stroke-width: 1.5;" x1="1249.5" x2="1411.5" y1="356.4688" y2="356.4688"/><ellipse cx="1259.5" cy="368.3711" fill="#84BE84" rx="3" ry="3" style="stroke: #038048; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="138" x="1268.5" y="370.6792">get_topic_name(): string</text><rect fill="#F24D5C" height="6" style="stroke: #C82930; stroke-width: 1.0;" width="6" x="1256.5" y="378.1758"/><text fill="#000000" font-family="sans-serif" font-size="11" font-style="italic" lengthAdjust="spacingAndGlyphs" textLength="91" x="1268.5" y="383.4839">validate_name()</text><!--class ServiceObject--><rect fill="#FEFECE" filter="url(#fr57tnwcoocqy)" height="57.5781" id="ServiceObject" style="stroke: #A80036; stroke-width: 1.5;" width="178" x="1866.5" y="332.5"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="85" x="1913" y="348.6387">ServiceObject</text><line style="stroke: #A80036; stroke-width: 1.5;" x1="1867.5" x2="2043.5" y1="356.4688" y2="356.4688"/><ellipse cx="1877.5" cy="368.3711" fill="#84BE84" rx="3" ry="3" style="stroke: #038048; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="152" x="1886.5" y="370.6792">get_service_name(): string</text><rect fill="#F24D5C" height="6" style="stroke: #C82930; stroke-width: 1.0;" width="6" x="1874.5" y="378.1758"/><text fill="#000000" font-family="sans-serif" font-size="11" font-style="italic" lengthAdjust="spacingAndGlyphs" textLength="91" x="1886.5" y="383.4839">validate_name()</text><!--class Publisher--><rect fill="#FEFECE" filter="url(#fr57tnwcoocqy)" height="44.7734" id="Publisher" style="stroke: #A80036; stroke-width: 1.5;" width="427" x="1117" y="509.5"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="58" x="1301.5" y="525.6387">Publisher</text><line style="stroke: #A80036; stroke-width: 1.5;" x1="1118" x2="1543" y1="533.4688" y2="533.4688"/><ellipse cx="1128" cy="545.3711" fill="#84BE84" rx="3" ry="3" style="stroke: #038048; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="401" x="1137" y="547.6792">publish(string message, optional&lt;EmailHeaders&gt; additional_headers)</text><!--class Subscription--><rect fill="#FEFECE" filter="url(#fr57tnwcoocqy)" height="91.1875" id="Subscription" style="stroke: #A80036; stroke-width: 1.5;" width="391" x="691" y="486.5"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="78" x="847.5" y="502.6387">Subscription</text><line style="stroke: #A80036; stroke-width: 1.5;" x1="692" x2="1081" y1="510.4688" y2="510.4688"/><rect fill="none" height="6" style="stroke: #C82930; stroke-width: 1.0;" width="6" x="699" y="519.3711"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="274" x="711" y="524.6792">messages: queue&lt;pair&lt;string, MessageInfo&gt;&gt;</text><line style="stroke: #A80036; stroke-width: 1.5;" x1="692" x2="1081" y1="531.2734" y2="531.2734"/><ellipse cx="702" cy="543.1758" fill="#84BE84" rx="3" ry="3" style="stroke: #038048; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="120" x="711" y="545.4839">has_message(): bool</text><ellipse cx="702" cy="555.9805" fill="#84BE84" rx="3" ry="3" style="stroke: #038048; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="189" x="711" y="558.2886">get_message(): optional&lt;string&gt;</text><ellipse cx="702" cy="568.7852" fill="#84BE84" rx="3" ry="3" style="stroke: #038048; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="365" x="711" y="571.0933">get_message_with_info(): optional&lt;pair&lt;string, MessageInfo&gt;&gt;</text><!--class ServiceClient--><rect fill="#FEFECE" filter="url(#fr57tnwcoocqy)" height="142.4063" id="ServiceClient" style="stroke: #A80036; stroke-width: 1.5;" width="509" x="1076" y="644"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="80" x="1290.5" y="660.1387">ServiceClient</text><line style="stroke: #A80036; stroke-width: 1.5;" x1="1077" x2="1584" y1="667.9688" y2="667.9688"/><rect fill="none" height="6" style="stroke: #C82930; stroke-width: 1.0;" width="6" x="1084" y="676.8711"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="389" x="1096" y="682.1792">responses: map&lt;SequenceNumber, pair&lt;EmailData, ServiceInfo&gt;&gt;</text><line style="stroke: #A80036; stroke-width: 1.5;" x1="1077" x2="1584" y1="688.7734" y2="688.7734"/><ellipse cx="1087" cy="700.6758" fill="#84BE84" rx="3" ry="3" style="stroke: #038048; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="301" x="1096" y="702.9839">send_request(string request, SequenceNumber seq)</text><ellipse cx="1087" cy="713.4805" fill="#84BE84" rx="3" ry="3" style="stroke: #038048; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="239" x="1096" y="715.7886">send_request(request): SequenceNumber</text><ellipse cx="1087" cy="726.2852" fill="#84BE84" rx="3" ry="3" style="stroke: #038048; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="247" x="1096" y="728.5933">has_response(SequenceNumber seq): bool</text><ellipse cx="1087" cy="739.0898" fill="#84BE84" rx="3" ry="3" style="stroke: #038048; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="121" x="1096" y="741.3979">has_response(): bool</text><ellipse cx="1087" cy="751.8945" fill="#84BE84" rx="3" ry="3" style="stroke: #038048; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="316" x="1096" y="754.2026">get_response(SequenceNumber seq): optional&lt;string&gt;</text><ellipse cx="1087" cy="764.6992" fill="#84BE84" rx="3" ry="3" style="stroke: #038048; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="483" x="1096" y="767.0073">get_response_with_info(SequenceNumber seq): optional&lt;pair&lt;string, ServiceInfo&gt;&gt;</text><ellipse cx="1087" cy="777.5039" fill="#84BE84" rx="3" ry="3" style="stroke: #038048; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="357" x="1096" y="779.812">get_response_with_info(): optional&lt;pair&lt;string, ServiceInfo&gt;&gt;</text><!--class ServiceServer--><rect fill="#FEFECE" filter="url(#fr57tnwcoocqy)" height="103.9922" id="ServiceServer" style="stroke: #A80036; stroke-width: 1.5;" width="428" x="1579.5" y="480"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacingAndGlyphs" textLength="85" x="1751" y="496.1387">ServiceServer</text><line style="stroke: #A80036; stroke-width: 1.5;" x1="1580.5" x2="2006.5" y1="503.9688" y2="503.9688"/><rect fill="none" height="6" style="stroke: #C82930; stroke-width: 1.0;" width="6" x="1587.5" y="512.8711"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="280" x="1599.5" y="518.1792">requests: queue&lt;pair&lt;EmailData, ServiceInfo&gt;&gt;</text><line style="stroke: #A80036; stroke-width: 1.5;" x1="1580.5" x2="2006.5" y1="524.7734" y2="524.7734"/><ellipse cx="1590.5" cy="536.6758" fill="#84BE84" rx="3" ry="3" style="stroke: #038048; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="111" x="1599.5" y="538.9839">has_request(): bool</text><ellipse cx="1590.5" cy="549.4805" fill="#84BE84" rx="3" ry="3" style="stroke: #038048; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="235" x="1599.5" y="551.7886">get_request(): optional&lt;ServiceRequest&gt;</text><ellipse cx="1590.5" cy="562.2852" fill="#84BE84" rx="3" ry="3" style="stroke: #038048; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="402" x="1599.5" y="564.5933">get_request_with_info(): optional&lt;pair&lt;ServiceRequest, ServiceInfo&gt;&gt;</text><ellipse cx="1590.5" cy="575.0898" fill="#84BE84" rx="3" ry="3" style="stroke: #038048; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacingAndGlyphs" textLength="357" x="1599.5" y="577.3979">send_response(ServiceRequestId request_id, string response)</text><!--link EmailReceiver to PollingManager--><path d="M838.5,79.18 C838.5,93.64 838.5,110.16 838.5,125.72 " fill="none" id="EmailReceiver-PollingManager" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#FFFFFF" points="838.5,66.05,834.5,72.05,838.5,78.05,842.5,72.05,838.5,66.05" style="stroke: #A80036; stroke-width: 1.0;"/><!--link EmailHandler to SubscriptionHandler--><path d="M344.66,232.41 C333.73,258.27 320.22,290.21 309.43,315.72 " fill="none" id="EmailHandler-SubscriptionHandler" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="none" points="338.37,229.31,352.61,213.62,351.27,234.76,338.37,229.31" style="stroke: #A80036; stroke-width: 1.0;"/><!--link PollingManager to SubscriptionHandler--><path d="M687.58,233.7 C607.11,259.39 508.77,290.8 430.09,315.92 " fill="none" id="PollingManager-SubscriptionHandler" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="692.37,232.17,682.5787,231.1065,687.6084,233.6954,685.0194,238.7251,692.37,232.17" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="85" x="599.4122" y="230.9387">registers with</text><!--link EmailHandler to ServiceHandler--><path d="M471.25,219.65 C545.19,243.31 645.42,275.38 731.58,302.94 " fill="none" id="EmailHandler-ServiceHandler" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="none" points="469,226.28,452.08,213.52,473.26,212.95,469,226.28" style="stroke: #A80036; stroke-width: 1.0;"/><!--link PollingManager to ServiceHandler--><path d="M864.68,248.26 C872.1,266.04 880.13,285.31 887.42,302.77 " fill="none" id="PollingManager-ServiceHandler" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="862.61,243.29,862.3641,253.1358,864.526,247.9083,869.7534,250.0702,862.61,243.29" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="85" x="775.4837" y="263.0411">registers with</text><!--link GidObject to PubSubObject--><path d="M1770.65,200.06 C1687.09,218.51 1544.94,253.92 1429.5,303 C1410.48,311.09 1390.57,322.09 1373.64,332.31 " fill="none" id="GidObject-PubSubObject" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="none" points="1769.3,193.19,1790.33,195.79,1772.27,206.87,1769.3,193.19" style="stroke: #A80036; stroke-width: 1.0;"/><!--link NamedObject to PubSubObject--><path d="M1407.69,240.96 C1388.09,271.32 1364.62,307.65 1348.75,332.23 " fill="none" id="NamedObject-PubSubObject" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="none" points="1401.97,236.91,1418.7,223.9,1413.73,244.5,1401.97,236.91" style="stroke: #A80036; stroke-width: 1.0;"/><!--link GidObject to ServiceObject--><path d="M1873.48,234.6 C1894.04,266.16 1920.02,306.04 1937.17,332.36 " fill="none" id="GidObject-ServiceObject" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="none" points="1867.46,238.18,1862.41,217.6,1879.19,230.53,1867.46,238.18" style="stroke: #A80036; stroke-width: 1.0;"/><!--link NamedObject to ServiceObject--><path d="M1548.86,209.36 C1632.08,229.78 1750.31,262.3 1849.5,303 C1869.55,311.23 1890.71,322.2 1908.81,332.35 " fill="none" id="NamedObject-ServiceObject" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="none" points="1547.08,216.13,1529.28,204.63,1550.37,202.53,1547.08,216.13" style="stroke: #A80036; stroke-width: 1.0;"/><!--link PubSubObject to Publisher--><path d="M1330.5,411.02 C1330.5,443.51 1330.5,484.72 1330.5,509.41 " fill="none" id="PubSubObject-Publisher" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="none" points="1323.5,410.7,1330.5,390.7,1337.5,410.7,1323.5,410.7" style="stroke: #A80036; stroke-width: 1.0;"/><!--link EmailSender to Publisher--><path d="M1576.58,396.81 C1514.79,430.51 1422.41,480.88 1370.19,509.36 " fill="none" id="EmailSender-Publisher" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#FFFFFF" points="1588.13,390.51,1580.9477,389.8659,1577.5907,396.2479,1584.773,396.892,1588.13,390.51" style="stroke: #A80036; stroke-width: 1.0;"/><!--link PubSubObject to Subscription--><path d="M1268.71,400.7 C1256.3,407.61 1243.17,414.39 1230.5,420 C1172.55,445.67 1106.78,468.36 1048.38,486.43 " fill="none" id="PubSubObject-Subscription" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="none" points="1265.42,394.52,1286.25,390.61,1272.4,406.65,1265.42,394.52" style="stroke: #A80036; stroke-width: 1.0;"/><!--link SubscriptionHandler to Subscription--><path d="M453.11,408.47 C538.97,432.75 643.87,462.4 728.96,486.46 " fill="none" id="SubscriptionHandler-Subscription" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="448.26,407.1,455.8371,413.3919,453.0724,408.4566,458.0077,405.692,448.26,407.1" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="85" x="380.9092" y="427.2936">registers with</text><!--link ServiceObject to ServiceClient--><path d="M1991.5,406.66 C2026.35,455.05 2068.16,532.63 2025.5,584 C1969.53,651.41 1759.88,684.06 1585.34,699.76 " fill="none" id="ServiceObject-ServiceClient" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="none" points="1985.81,410.74,1979.38,390.55,1997,402.32,1985.81,410.74" style="stroke: #A80036; stroke-width: 1.0;"/><!--link Publisher to ServiceClient--><path d="M1330.5,567.87 C1330.5,589.35 1330.5,617.66 1330.5,643.64 " fill="none" id="Publisher-ServiceClient" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="1330.5,554.83,1326.5,560.83,1330.5,566.83,1334.5,560.83,1330.5,554.83" style="stroke: #A80036; stroke-width: 1.0;"/><!--link ServiceHandler to ServiceClient--><path d="M731.45,422.9 C708.44,438.03 687.93,456.79 673.5,480 C649.1,519.26 644.16,548.28 673.5,584 C724.75,646.39 913.74,679.34 1075.95,696.44 " fill="none" id="ServiceHandler-ServiceClient" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="735.78,420.11,726.0464,421.6121,731.5741,422.8138,730.3724,428.3415,735.78,420.11" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="85" x="625.5483" y="439.8403">registers with</text><!--link ServiceObject to ServiceServer--><path d="M1914.22,405.43 C1892.43,428.1 1865.54,456.07 1842.67,479.86 " fill="none" id="ServiceObject-ServiceServer" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="none" points="1909.48,400.27,1928.38,390.7,1919.57,409.97,1909.48,400.27" style="stroke: #A80036; stroke-width: 1.0;"/><!--link EmailSender to ServiceServer--><path d="M1674.05,400.3 C1695.5,423.77 1723.35,454.24 1746.76,479.86 " fill="none" id="EmailSender-ServiceServer" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#FFFFFF" points="1665.28,390.7,1666.3742,397.8276,1673.3744,399.559,1672.2802,392.4314,1665.28,390.7" style="stroke: #A80036; stroke-width: 1.0;"/><!--link ServiceHandler to ServiceServer--><path d="M1218.67,417.9 C1382.42,447.45 1552.3,478.16 1561.5,480 C1567.36,481.17 1573.31,482.38 1579.3,483.61 " fill="none" id="ServiceHandler-ServiceServer" style="stroke: #A80036; stroke-width: 1.0;"/><polygon fill="#A80036" points="1213.34,416.94,1221.4906,422.4688,1218.2612,417.8244,1222.9056,414.595,1213.34,416.94" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="85" x="1221.4105" y="415.1344">registers with</text><!--
@startuml

hide empty attributes
hide empty methods
hide circle


class EmailSender {
   +send(EmailContent, optional<EmailHeaders>): bool {abstract}
   +reply(EmailContent, EmailData, optional<EmailHeaders>): bool {abstract}
}

class EmailReceiver {
   +get_email(nanoseconds polling_period): optional<EmailData> {abstract}
   +shutdown()
}


class PollingManager {
   -thread
   -handlers: vector<function<void (EmailData)>>
   -poll_thread()
   +start()
   +shutdown()
   +register_handler(function<void (EmailData)>)
}
EmailReceiver o- - PollingManager

abstract class EmailHandler {
   +register_handler(shared_ptr<PollingManager>) {abstract}
   +handle(EmailData) {abstract}
}


class SubscriptionHandler {
   -subscriptions: map<string, queue<pair<string, MessageInfo>>>
   +register_subscription(string topic_name, queue<pair<string, MessageInfo>> message_queue)
   +register_handler(shared_ptr<PollingManager>) {abstract}
   +handle(EmailData) {abstract}
}
EmailHandler <|- - SubscriptionHandler
PollingManager "registers with" <- - SubscriptionHandler

class ServiceHandler {
   -clients: map<GidValue, shared_ptr<map<SequenceNumber, pair<EmailData, ServiceInfo>>>>
   -servers: map<string, shared_ptr<queue<pair<EmailData, ServiceInfo>>>>
   +register_service_client(Gid, map<SequenceNumber, pair<EmailData, ServiceInfo>> response_map)
   +register_service_server(string service_name, queue<pair<EmailData, ServiceInfo>> request_queue)
   +register_handler(shared_ptr<PollingManager>) {abstract}
   +handle(EmailData) {abstract}
}
EmailHandler <|- - ServiceHandler
PollingManager "registers with" <- - ServiceHandler


class GidObject {
   -gid: Gid
   +get_gid(): Gid
}
class NamedObject {
   -object_name: string
   #get_object_name(): string
   #validate_name() {abstract}
}

class PubSubObject {
   +get_topic_name(): string
   -validate_name() {abstract}
}
GidObject <|- - PubSubObject
NamedObject <|- - PubSubObject

class ServiceObject {
   +get_service_name(): string
   -validate_name() {abstract}
}
GidObject <|- - ServiceObject
NamedObject <|- - ServiceObject


class Publisher {
   +publish(string message, optional<EmailHeaders> additional_headers)
}
PubSubObject <|- - Publisher
EmailSender o- - Publisher

class Subscription {
   -messages: queue<pair<string, MessageInfo>>
   +has_message(): bool
   +get_message(): optional<string>
   +get_message_with_info(): optional<pair<string, MessageInfo>>
}
PubSubObject <|- - Subscription
SubscriptionHandler "registers with" <- - Subscription


class ServiceClient {
   -responses: map<SequenceNumber, pair<EmailData, ServiceInfo>>
   +send_request(string request, SequenceNumber seq)
   +send_request(request): SequenceNumber
   +has_response(SequenceNumber seq): bool
   +has_response(): bool
   +get_response(SequenceNumber seq): optional<string>
   +get_response_with_info(SequenceNumber seq): optional<pair<string, ServiceInfo>>
   +get_response_with_info(): optional<pair<string, ServiceInfo>>
}
ServiceObject <|- - ServiceClient
Publisher *- - ServiceClient
ServiceHandler "registers with" <- - ServiceClient

class ServiceServer {
   -requests: queue<pair<EmailData, ServiceInfo>>
   +has_request(): bool
   +get_request(): optional<ServiceRequest>
   +get_request_with_info(): optional<pair<ServiceRequest, ServiceInfo>>
   +send_response(ServiceRequestId request_id, string response)
}
ServiceObject <|- - ServiceServer
EmailSender o- - ServiceServer
ServiceHandler "registers with" <- - ServiceServer

@enduml

PlantUML version 1.2018.13(Mon Nov 26 17:11:51 UTC 2018)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Java Version: 11.0.14.1+1
Operating System: Linux
OS Version: 5.11.0-1028-azure
Default Encoding: UTF-8
Language: en
Country: null
--></g></svg>